<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion2Anki Complete - Export & Convert to APKG</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1><i class="fas fa-brain"></i> Notion2Anki Complete</h1>
            <p>Export Notion pages directly OR upload ZIP → Convert to Anki APKG</p>
        </header>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" onclick="switchTab('export')">
                <i class="fas fa-download"></i> Export từ Notion
            </button>
            <button class="tab-btn" onclick="switchTab('upload')">
                <i class="fas fa-upload"></i> Upload ZIP/HTML
            </button>
        </div>

        <!-- Export Tab -->
        <div id="exportTab" class="tab-content active">
            <div class="card">
                <h2><i class="fas fa-key"></i> 1. Thông tin Notion</h2>
                
                <div class="input-group">
                    <label for="notionToken">
                        Notion Token (token_v2)
                        <span class="tooltip" data-tooltip="Tìm trong browser cookies khi đăng nhập Notion">ℹ️</span>
                    </label>
                    <div class="input-with-button">
                        <input 
                            type="password" 
                            id="notionToken" 
                            placeholder="Your Notion token_v2"
                            autocomplete="off"
                        >
                        <button class="btn-icon" onclick="toggleTokenVisibility()">
                            <i class="fas fa-eye" id="toggleIcon"></i>
                        </button>
                    </div>
                </div>

                <div class="input-group">
                    <label for="notionPageUrl">
                        Page URL hoặc Page ID
                        <span class="tooltip" data-tooltip="VD: https://notion.so/Page-Name-abc123... hoặc chỉ abc123...">ℹ️</span>
                    </label>
                    <input 
                        type="text" 
                        id="notionPageUrl" 
                        placeholder="https://notion.so/... hoặc page-id"
                    >
                </div>

                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="recursiveExport" checked>
                        <span>Export đệ quy (bao gồm subpages)</span>
                    </label>
                </div>

                <div class="info-box">
                    <p><strong>Cách lấy Notion Token:</strong></p>
                    <ol>
                        <li>Mở Notion và đăng nhập</li>
                        <li>Mở Developer Tools (F12)</li>
                        <li>Application → Cookies → notion.so</li>
                        <li>Tìm cookie <code>token_v2</code> và copy value</li>
                    </ol>
                </div>
            </div>

            <div class="card">
                <h2><i class="fas fa-cog"></i> 2. Cài đặt Deck</h2>
                
                <div class="input-group">
                    <label for="deckNameExport">
                        <i class="fas fa-layer-group"></i> Tên Deck
                    </label>
                    <input type="text" id="deckNameExport" value="Notion" placeholder="Tên deck Anki...">
                </div>

                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="autoDetectExport" checked>
                        <span>Tự động nhận diện Note Type (Basic/Cloze)</span>
                    </label>
                </div>
            </div>

            <div class="card">
                <h2><i class="fas fa-rocket"></i> 3. Export & Convert</h2>
                <div class="buttons">
                    <button class="btn btn-primary" onclick="exportFromNotion()">
                        <i class="fas fa-magic"></i> Export từ Notion & Tạo APKG
                    </button>
                </div>
            </div>
        </div>

        <!-- Upload Tab -->
        <div id="uploadTab" class="tab-content">
            <div class="card">
                <h2><i class="fas fa-cloud-upload-alt"></i> 1. Upload Notion Export</h2>
                
                <div class="file-drop-zone" id="dropZone">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Kéo thả file ZIP hoặc HTML vào đây<br>hoặc click để chọn file</p>
                    <input type="file" id="fileInput" accept=".zip,.html" style="display:none">
                </div>

                <div class="file-info" id="fileInfo">
                    <p><strong>File:</strong> <span id="fileName"></span></p>
                    <p><strong>Kích thước:</strong> <span id="fileSize"></span></p>
                    <p><strong>Loại:</strong> <span id="fileType"></span></p>
                </div>

                <div class="info-box">
                    <p><strong>Hướng dẫn export từ Notion:</strong></p>
                    <ol>
                        <li>Mở page trong Notion → Click "..." → Export</li>
                        <li>Chọn Export format: <strong>HTML</strong></li>
                        <li>Include subpages: Tùy chọn</li>
                        <li>Download file ZIP và upload vào đây</li>
                    </ol>
                </div>
            </div>

            <div class="card">
                <h2><i class="fas fa-cog"></i> 2. Cài đặt Export</h2>
                
                <div class="input-group">
                    <label for="deckNameUpload">
                        <i class="fas fa-layer-group"></i> Tên Deck
                    </label>
                    <input type="text" id="deckNameUpload" value="Notion" placeholder="Tên deck Anki...">
                </div>

                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="autoDetectUpload" checked>
                        <span>Tự động nhận diện Note Type (Basic/Cloze)</span>
                    </label>
                </div>

                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="includeMedia" checked>
                        <span>Bao gồm media (ảnh, video)</span>
                    </label>
                </div>
            </div>

            <div class="card">
                <h2><i class="fas fa-download"></i> 3. Export APKG</h2>
                
                <div class="buttons">
                    <button class="btn btn-primary" id="processBtn" disabled onclick="processUploadedFile()">
                        <i class="fas fa-magic"></i> Xử lý & Export APKG
                    </button>
                    <button class="btn btn-secondary" onclick="resetUpload()">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                </div>
            </div>
        </div>

        <!-- Stats Section (shared) -->
        <div class="card" id="statsCard" style="display:none;">
            <h2><i class="fas fa-chart-bar"></i> Thống kê</h2>
            
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="totalNotes">0</div>
                    <div class="stat-label">Tổng Notes</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="basicNotes">0</div>
                    <div class="stat-label">Basic Notes</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="clozeNotes">0</div>
                    <div class="stat-label">Cloze Notes</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="mediaCount">0</div>
                    <div class="stat-label">Media Files</div>
                </div>
            </div>
        </div>

        <!-- Progress Card (shared) -->
        <div class="progress-card" id="progressCard">
            <h3><i class="fas fa-spinner fa-spin"></i> <span id="progressTitle">Đang xử lý...</span></h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="progress-text" id="progressText">Initializing...</p>
        </div>

        <!-- Status Message -->
        <div id="statusMessage" class="status-message"></div>

        <!-- Footer -->
        <footer class="footer">
            <p>Made with ❤️ for Notion & Anki users | <a href="https://github.com/yourusername/notion2anki-complete" target="_blank">GitHub</a></p>
            <p class="disclaimer">Uses Notion's unofficial API. Use at your own risk.</p>
        </footer>
    </div>

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- App Scripts -->
    <script src="notion-export.js"></script>
    <script src="anki-builder.js"></script>
    <script src="app.js"></script>
</body>
</html>
